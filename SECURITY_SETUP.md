# Security Setup Guide

## üîí Critical Security Steps

### 1. Generate New Secret Keys

**IMPORTANT:** Never use the example keys. Generate your own!

#### Generate NEXTAUTH_SECRET:
```bash
# On Windows (PowerShell):
[Convert]::ToBase64String((1..32 | ForEach {Get-Random -Maximum 256}))

# On Mac/Linux:
openssl rand -base64 32
```

#### Generate ENCRYPTION_KEY:
```bash
# On Windows (PowerShell):
[Convert]::ToBase64String((1..32 | ForEach {Get-Random -Maximum 256}))

# On Mac/Linux:
openssl rand -base64 32
```

#### Generate CRON_SECRET:
```bash
# On Windows (PowerShell):
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 16 | % {[char]$_})

# On Mac/Linux:
openssl rand -hex 8
```

### 2. Create Your .env.local File

1. Copy `.env.example` to `.env.local`:
   ```bash
   cp .env.example .env.local
   ```

2. Replace ALL placeholder values with your actual keys

3. **NEVER** commit `.env.local` to git!

### 3. Get Required API Keys

#### Google OAuth:
1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a new project or select existing
3. Enable Gmail API
4. Create OAuth 2.0 credentials
5. Add redirect URI: `http://localhost:3000/api/auth/callback/google` (for dev)
6. Add redirect URI: `https://yourdomain.com/api/auth/callback/google` (for production)

#### Anthropic API:
1. Go to [Anthropic Console](https://console.anthropic.com)
2. Create an API key
3. Keep it secret!

#### Database:
1. Sign up at [Neon.tech](https://neon.tech) (free tier available)
2. Create a PostgreSQL database
3. Copy the connection string

#### Lemon Squeezy (for payments):
1. Sign up at [Lemon Squeezy](https://lemonsqueezy.com)
2. Create a store
3. Get API key from Settings > API
4. Create a product/variant
5. Setup webhook endpoint: `https://yourdomain.com/api/webhooks/lemonsqueezy`

### 4. Environment Variables for Production

When deploying to Vercel, Railway, or any hosting platform:

1. **DO NOT** upload `.env.local` file
2. Instead, add environment variables in the platform's dashboard:
   - Vercel: Project Settings > Environment Variables
   - Railway: Variables tab
   - Render: Environment tab

3. Add all variables from `.env.local` to your hosting platform

### 5. Security Checklist

Before going to production:

- [ ] All API keys are unique and generated by you
- [ ] `.env.local` is in `.gitignore`
- [ ] No secrets in your code files
- [ ] Database has SSL enabled (`?sslmode=require`)
- [ ] Webhook secrets are configured
- [ ] Production environment variables are set in hosting platform
- [ ] Google OAuth redirect URIs include your production domain
- [ ] Rate limiting is enabled
- [ ] Error messages don't expose sensitive information

### 6. Rotating Compromised Keys

If any key is exposed:

1. **Immediately** generate a new key
2. Update it in your hosting platform
3. Revoke the old key from the service provider
4. Check logs for unauthorized usage
5. Notify affected users if necessary

### 7. For Customers (if selling source code)

Include these instructions for your customers:

```markdown
## Security Setup for Customers

1. Generate ALL new keys (don't use seller's keys)
2. Never share your API keys
3. Use environment variables, not hardcoded values
4. Enable 2FA on all service accounts
5. Regularly rotate sensitive keys
6. Monitor API usage for anomalies
```

### 8. Additional Security Measures

```typescript
// Add to your code for extra security:

// Rate limiting (install: npm install express-rate-limit)
import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100 // limit each IP to 100 requests per windowMs
});

// Input validation (already have zod installed)
import { z } from 'zod';

const emailSchema = z.string().email();
const validateEmail = (email: string) => {
  return emailSchema.safeParse(email);
};

// Sanitize user input
import DOMPurify from 'isomorphic-dompurify';
const clean = DOMPurify.sanitize(dirty);
```

## ‚ö†Ô∏è What Could Go Wrong

If you don't secure your app:

1. **API Key Theft**: Attackers use your keys, you get the bill
2. **Data Breach**: User emails and data exposed
3. **Service Hijacking**: Someone takes over your app
4. **Financial Loss**: Unexpected charges from API usage
5. **Legal Issues**: GDPR/privacy violations
6. **Reputation Damage**: Loss of customer trust

## ‚úÖ You're Secure When:

- Git status shows no sensitive files staged
- All keys in `.env.local` are your own (not from examples)
- Production uses environment variables from hosting platform
- Webhook signature verification is enabled
- No secrets appear in browser console or error messages
- You can rotate any key without changing code

Remember: Security isn't optional when handling user data!